#version 400

layout (points) in;
layout (triangle_strip, max_vertices = 4) out;

out vec2 texCoord;

uniform uniBall
{
	mat4 uniTrans;
	mat4 projView;
	vec4 eyePos;
	vec4 size;
};

void main()
{
	vec3 Pos = gl_in[0].gl_Position.xyz;
	
	vec3 toCamera = normalize(eyePos.xyz - Pos.xyz);
	vec3 up = vec3(0.0f, 1.0f, 0.0f);
	vec3 right = cross(toCamera, up);
	
	mat4x4 world;
	world[0] = float4(right, 0.0f);
	world[1] = float4(up, 0.0f);
	world[2] = float4(toCamera, 0.0f);
	world[3] = float4(Pos.xyz, 1.0f);
	
	
	Pos.y += size.y;
    Pos -= right*size.x;
    gl_Position = projView * uniTrans * world * vec4(Pos, 1.0f);
    texCoord = vec2(0.0f, 0.0f);
    EmitVertex();

    Pos.y += size.y;
    gl_Position = projView * uniTrans * world * vec4(Pos, 1.0f);
    texCoord = vec2(0.0f, 1.0f);
    EmitVertex();

    Pos.y -= size.y;
    Pos += right*size.x;
    gl_Position = projView * uniTrans * world * vec4(Pos, 1.0f);
    texCoord = vec2(1.0f, 0.0f);
    EmitVertex();

    Pos.y += size.y;
    gl_Position = projView * uniTrans * vec4(Pos, 1.0f);
    texCoord = vec2(1.0f, 1.0f);
    EmitVertex();

    EndPrimitive();
}